export const newLatitudeLongitude = (t, a, e, h) => { const n = 6378137, M = 1 / 298.257223563, s = n * (1 - M), o = t => t * Math.PI / 180, i = t => 180 * t / Math.PI; let r; switch (h) { case "N": r = 0; break; case "S": r = Math.PI; break; case "E": r = Math.PI / 2; break; case "W": r = 3 * Math.PI / 2; break; default: throw new Error("Direcție invalidă") }const c = o(t), l = o(a), d = Math.atan((1 - M) * Math.tan(c)), u = Math.sin(d), w = Math.cos(d), b = Math.sin(r), I = Math.cos(r), P = w * b, f = 1 - P * P, g = f * (n * n - s * s) / (s * s), k = 1 + g / 16384 * (4096 + g * (g * (320 - 175 * g) - 768)), p = g / 1024 * (256 + g * (g * (74 - 47 * g) - 128)); let E, q, v, x, L, m = e / (s * k), y = 0; do { x = Math.cos(2 * Math.atan2(u, w * I) + m), q = Math.sin(m), v = Math.cos(m), L = p * q * (x + p / 4 * (v * (2 * x * x - 1) - p / 6 * x * (4 * q * q - 3) * (4 * x * x - 3))), E = m, m = e / (s * k) + L } while (Math.abs(m - E) > 1e-12 && ++y < 100); const D = u * q - w * v * I, N = Math.atan2(u * v + w * q * I, (1 - M) * Math.sqrt(P * P + D * D)), S = M / 16 * f * (4 + M * (4 - 3 * f)), V = l + (Math.atan2(q * b, w * v - u * q * I) - (1 - S) * M * P * (m + S * q * (x + S * v * (2 * x * x - 1)))); return { latitude: i(N), longitude: i(V) } }; export const distance = t => { const { start: a, stop: e } = t, h = 6378137, n = 1 / 298.257223563, M = h * (1 - n), s = t => t * Math.PI / 180, o = s(a.latitude), i = s(e.latitude), r = s(e.longitude - a.longitude), c = Math.atan((1 - n) * Math.tan(o)), l = Math.atan((1 - n) * Math.tan(i)), d = Math.sin(c), u = Math.cos(c), w = Math.sin(l), b = Math.cos(l); let I, P, f, g, k, p, E, q, v, x, L = r, m = 100; do { if (P = Math.sin(L), f = Math.cos(L), g = Math.sqrt((b * P) ** 2 + (u * w - d * b * f) ** 2), 0 === g) return 0; k = d * w + u * b * f, p = Math.atan2(g, k), E = u * b * P / g, q = 1 - E * E, v = 0 !== q ? k - 2 * d * w / q : 0, x = n / 16 * q * (4 + n * (4 - 3 * q)), I = L, L = r + (1 - x) * n * E * (p + x * g * (v + x * k * (2 * v * v - 1))) } while (Math.abs(L - I) > 1e-12 && --m > 0); if (0 === m) throw new Error("Vincenty formula failed to converge"); const y = q * (h * h - M * M) / (M * M), D = y / 1024 * (256 + y * (y * (74 - 47 * y) - 128)); return M * (1 + y / 16384 * (4096 + y * (y * (320 - 175 * y) - 768))) * (p - D * g * (v + D / 4 * (k * (2 * v * v - 1) - D / 6 * v * (4 * g * g - 3) * (4 * v * v - 3)))) };