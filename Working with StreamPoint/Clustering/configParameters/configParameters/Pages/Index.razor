@page "/"
@using LeafletForBlazor.RealTime.points
@using clusters.Data

<RealTimeMap height="calc(100vh - 6rem)" width="calc(100vw - 18rem)" OnAfterMapLoaded="@onAfterMapLoaded"></RealTimeMap>

@code {
    // You can add any additional code here if needed
        DataSource dataSource = new DataSource();
        private async Task onAfterMapLoaded(RealTimeMap.MapEventArgs args)
        {
            // This method can be used to perform actions after the map has loaded
            args.sender.Geometric.Points.clusteringAfterCollectionUpdate = true;
            args.sender.Geometric.Points.clusteringConfiguration = new ClusteringConfiguration()
                {
                    showCoverageOnHover = true,     // Show coverage on hover
                    spiderfyOnMaxZoom = true,       // Spiderfy markers when zoomed in
                    zoomToBoundsOnClick = false,    // Zoom to bounds when clicking on a cluster
                    maxClusterRadius = 120,         // Maximum radius of a cluster when it is not zoomed in px
                };
            
         
            await args.sender.Geometric.Points.upload(dataSource.pointsStart);

            foreach (var item in dataSource.pointsMore)
            {
                await args.sender.Geometric.Points.add(item);
            }
            StateHasChanged();
        }
}